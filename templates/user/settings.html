{% extends "base.html" %}

{% block title %}Settings{% endblock %}

{% block content %}
<h2>⚙️ Settings</h2>

{% with messages = get_flashed_messages() %}
    {% if messages %}
        {% for msg in messages %}
            <div class="alert alert-info">{{msg}}</div>
        {% endfor %}
    {% endif %}
{% endwith %}

<div class="card mt-4">
    <div class="card-body">
        <h5>Appearance</h5>
        <button id="darkModeButton" class="btn btn-secondary mt-2">
            <span id="buttonText">Switch to Dark Mode</span>
        </button>
    </div>
</div>

<div class="card mt-4">
    <div class="card-body">
        <h5>Account Actions</h5>

        <form method="POST" action="{{ url_for('auth.logout') }}" style="display: inline;">
            <button type="submit" class="btn btn-warning mt-2">Logout</button>
        </form>

        <form method="POST" action="{{ url_for('user.settings') }}" class="mt-2" style="display: inline;"
              onsubmit="return confirm('Are you sure you want to delete your account? This action cannot be undone.');">
            <input type="hidden" name="action" value="delete">
            <button type="submit" class="btn btn-danger">Delete Account</button>
        </form>
    </div>
</div>

<script>
    const button = document.getElementById("darkModeButton");
    const buttonText = document.getElementById("buttonText");

    function updateButtonText() {
        if (document.body.classList.contains("dark-mode")) {
            buttonText.textContent = "Switch to Light Mode";
        } else {
            buttonText.textContent = "Switch to Dark Mode";
        }
    }

    updateButtonText();

    button.addEventListener("click", () => {
        document.body.classList.toggle("dark-mode");

        if (document.body.classList.contains("dark-mode")) {
            localStorage.setItem("theme", "dark");
        } else {
            localStorage.setItem("theme", "light");
        }

        updateButtonText();
    });
</script>
{% endblock %}